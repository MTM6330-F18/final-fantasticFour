!function(){function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){return i(t[a][1][e]||e)},d,d.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}return e}()({1:[function(e){var t;null==window.postMessage?"undefined"!=typeof console&&null!==console&&console.warn("Harvest Platform is disabled.\nTo start and stop timers, cross-domain messaging must be supported\nby your browser."):window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?null!=self.HarvestPlatform?self.HarvestPlatform.findTimers():(t=e("./platform/base"),self.HarvestPlatform=new t({stylesheet:".harvest-timer-icon,.harvest-timer.styled{border:0;font:inherit;font-size:0;line-height:1;margin:0;padding:0;vertical-align:top}.harvest-timer-icon{background:url(https://cache.harvestapp.com/assets/platform/timer-icon-5cc4df2acc507c16f0c6a6af06be8fa7a488eb67ff6cc5d654ea2b7c92ef5b21.png) no-repeat 0 0;display:inline-block;height:14px;width:12px}@media (-webkit-min-device-pixel-ratio: 1.25), (min-resolution: 1.25dppx), (min-resolution: 120dpi){.harvest-timer-icon{background:url(https://cache.harvestapp.com/assets/platform/timer-icon-retina-d607999b01160d5b7f947652624b51eb065ec23250e1aba1c710b4a32f8157c6.png) no-repeat 0 0;background-size:24px 14px}}.harvest-timer.styled{background-color:#fafafa;background-image:-webkit-gradient(linear, left top, left bottom, from(#fff), to(#eee));background-image:linear-gradient(#fff, #eee);border:1px solid #bbb;border-radius:2px;cursor:pointer;display:inline-block;height:14px;padding:2px 3px;width:12px;-webkit-font-smoothing:antialiased}.harvest-timer.styled:hover{background-color:#f0f0f0;background-image:-webkit-gradient(linear, left top, left bottom, from(#f8f8f8), to(#e8e8e8));background-image:linear-gradient(#f8f8f8, #e8e8e8)}.harvest-timer.styled:active{background:#eee;-webkit-box-shadow:inset 0 1px 4px rgba(0,0,0,0.1);box-shadow:inset 0 1px 4px rgba(0,0,0,0.1)}.harvest-timer.styled.running{background-color:#1385e5;background-image:-webkit-gradient(linear, left top, left bottom, from(#53b2fc), to(#1385e5));background-image:linear-gradient(#53b2fc, #1385e5);border-color:#075fa9}.harvest-timer.styled.running:hover{background-color:#0e7add;background-image:-webkit-gradient(linear, left top, left bottom, from(#49a4fd), to(#0e7add));background-image:linear-gradient(#49a4fd, #0e7add)}.harvest-timer.styled.running:active{background:#1385e5;-webkit-box-shadow:inset 0 1px 5px rgba(0,0,0,0.2);box-shadow:inset 0 1px 5px rgba(0,0,0,0.2)}.harvest-timer.styled.running>.harvest-timer-icon{background-position:-12px 0px}#harvest-iframe{background:white;border:none;border-radius:6px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,0.2),0 0 0 1px rgba(0,0,0,0.1);box-shadow:0 6px 12px rgba(0,0,0,0.2),0 0 0 1px rgba(0,0,0,0.1);height:300px;left:50%;margin:0;margin-left:-250px;overflow:hidden;padding:0;position:absolute;top:0;-webkit-transition:height 150ms;transition:height 150ms;width:500px}@media (min-height: 400px){#harvest-iframe{top:10%}}@media (min-height: 550px){#harvest-iframe{top:20%}}.harvest-overlay{background:rgba(0,0,0,0.6);height:100%;left:0;opacity:1;overflow:scroll;position:fixed;top:0;width:100%;z-index:9998}\n"})):"undefined"!=typeof console&&null!==console&&console.warn("Harvest Platform is disabled.\nTo check for running timers, xhr requests with credentials must be\nsupported by your browser.")},{"./platform/base":3}],2:[function(e,t){var n,r;r=.3,n=function(e){return e+e*r*Math.random()},t.exports=function(e,t){return setTimeout(e,n(t))}},{}],3:[function(e,t){var n,r,i=function(e,t){return function(){return e.apply(t,arguments)}},o=[].slice;n=e("./light_box"),r=e("../ext/set_fuzzy_timeout"),t.exports=function(){function e(e){var t;this.stylesheet=e.stylesheet,this.startWorker=i(this.startWorker,this),this.runningTimerCheckSoon=i(this.runningTimerCheckSoon,this),this.runningTimerCheck=i(this.runningTimerCheck,this),this.findTimers=i(this.findTimers,this),this.addTimers=i(this.addTimers,this),this.handlePlatformMessage=i(this.handlePlatformMessage,this),this.runningTimerCheck=this.debounce(this.runningTimerCheck),this.lightbox=new n,this.setupHarvestXDM(),t=document.createElement("style"),document.head.appendChild(t),t.appendChild(document.createTextNode(this.stylesheet)),window.addEventListener("message",this.handlePlatformMessage),this.listenForEvent("timers:add",this.addTimers),this.listenForEvent("timers:chrome:add",this.findTimers),this.findTimers(),this.xdm.setAttribute("data-ready",!0),this.sendMessage({element:document.body,type:"ready"})}return e.prototype.version=5,e.prototype.config=function(){return window._harvestPlatformConfig},e.prototype.shouldPoll=!0,e.prototype.pollingInterval=3e4,e.prototype.origin="https://platform.harvestapp.com",e.prototype.handlePlatformMessage=function(e){var t,n,r,i,o;switch(null!=(null!=e?e.data:void 0)&&(i=(r=e.data).type,o=r.value,t=r.group_id,n=r.item_id),i){case"frame:close":return this.lightbox.close();case"frame:resize":return this.lightbox.adjustHeight(o);case"timer:started":return this.setTimer({group:{id:t},item:{id:n}});case"timer:stopped":return this.stopTimer();case"harvest:websocket:connected":return this.shouldPoll=!1,this.runningTimerCheckSoon({cachebust:!0});case"harvest:websocket:disconnected":return this.shouldPoll=!0,this.runningTimerCheckSoon();case"harvest:websocket:event":return this.runningTimerCheck({cachebust:!0})}},e.prototype.setupHarvestXDM=function(){var e;if(e=this.hpNamespace("messaging"),!(this.xdm=document.getElementById(e)))return this.xdm=document.createElement("div"),this.xdm.id=e,this.xdm.style.display="none",document.body.appendChild(this.xdm)},e.prototype.listenForEvent=function(e,t){return null!=window.jQuery?window.jQuery(this.xdm).bind(this.hpEvent(e),t):this.xdm.addEventListener(this.hpEvent(e),t)},e.prototype.addTimers=function(e){var t,n,r,i;if(null!=(null!=(t=e.element||(null!=(n=e.originalEvent)&&null!=(r=n.detail)?r.element:void 0)||(null!=(i=e.detail)?i.element:void 0))?t.jquery:void 0)&&(t=t.get(0)),t)return this.findTimer(t)},e.prototype.findTimers=function(){var e,t,n,r,i,o;for(o="."+this.hpNamespace("timer")+":not([data-listening])",i=[],n=0,r=(t=document.querySelectorAll(o)).length;n<r;n++)e=t[n],i.push(this.findTimer(e));return i},e.prototype.findTimer=function(e){var t,n;return t=e.getAttribute("data-skip-styling"),this.config().skipStyling||e.classList.contains("styled")||null!=t&&!1!==t&&"false"!==t||(e.innerHTML="<span class='harvest-timer-icon'></span>",e.classList.add("styled")),e.addEventListener("click",(n=this,function(t){return t.stopPropagation(),n.openIframe(n.getData(e))})),e.setAttribute("data-listening",!0),this.runningTimerCheck()},e.prototype.setTimer=function(e){var t,n,r,i,o,a,s,l,u,d,c;for(c=[],i=0,a=(s=document.querySelectorAll("."+this.hpNamespace("timer"))).length;i<a;i++)n=s[i],r=(l=this.getData(n)).group,o=l.item,null==e||(null!=r?r.id:void 0)!==(null!=(u=e.group)?u.id:void 0)||(null!=o?o.id:void 0)!==(null!=(d=e.item)?d.id:void 0)?(n.classList.remove("running"),c.push(function(){var e,r,i,o;for(o=[],e=0,r=(i=n.children).length;e<r;e++)t=i[e],o.push(t.classList.remove("running"));return o}())):(n.classList.add("running"),c.push(function(){var e,r,i,o;for(o=[],e=0,r=(i=n.children).length;e<r;e++)t=i[e],o.push(t.classList.add("running"));return o}()));return c},e.prototype.stopTimer=function(){return this.setTimer(null)},e.prototype.getData=function(e){var t,n,r,i,o;for(t={},n=0,i=(o=["account","item","group","default","skip-styling"]).length;n<i;n++)t[r=o[n]]=this.getValue(e,r);return null==t.group&&(t.group=this.getValue(e,"project")),t.permalink=e.getAttribute("data-permalink"),t},e.prototype.getValue=function(e,t){var n;return null!=(null!=(n=function(){var n;try{return JSON.parse(null!=(n=e.getAttribute("data-"+t))?n:"null")}catch(r){}}())?n.id:void 0)&&(n.id=""+n.id),n},e.prototype.createPermalink=function(e,t){return null!=e&&null!=t&&(null!=t.account&&(e=e.replace("%ACCOUNT_ID%",t.account.id)),null!=t.group&&(e=e.replace("%PROJECT_ID%",t.group.id)),null!=t.group&&(e=e.replace("%GROUP_ID%",t.group.id)),null!=t.item&&(e=e.replace("%ITEM_ID%",t.item.id))),e},e.prototype.openIframe=function(e){var t,n,r,i,o,a,s,l;return t={app_name:this.config().applicationName,service:e.service||window.location.hostname,permalink:e.permalink||this.createPermalink(this.config().permalink,e),external_account_id:null!=(n=e.account)?n.id:void 0,external_group_id:null!=(r=e.group)?r.id:void 0,external_group_name:null!=(i=e.group)?i.name:void 0,external_item_id:null!=(o=e.item)?o.id:void 0,external_item_name:null!=(a=e.item)?a.name:void 0,default_project_code:null!=(s=e["default"])?s.project_code:void 0,default_project_name:null!=(l=e["default"])?l.project_name:void 0},this.lightbox.open(this.hpURL("/platform/timer?"+this.param(t)))},e.prototype.runningTimerCheck=function(e){var t,n;return null==e&&(e={}),clearTimeout(this.runningTimerCheckTimer),e.cachebust&&(t="?"+this.param({_:(new Date).getTime()})),this.get(this.hpURL("/platform/running_timer.json"+(t||"")),(n=this,function(e,t){if(200===e&&(null!=t?n.setTimer({group:{id:t.group_id},item:{id:t.id}}):n.stopTimer(),n.startWorker()),401!==e&&n.shouldPoll)return n.runningTimerCheckTimer=r(n.runningTimerCheck,n.pollingInterval)}))},e.prototype.runningTimerCheckSoon=function(e){var t,n;return null==e&&(e={}),t=this.runningTimerCheck.bind(null,e),n=Math.random()*this.pollingInterval,clearTimeout(this.runningTimerCheckTimer),this.runningTimerCheckTimer=setTimeout(t,n)},e.prototype.startWorker=function(){if(!this.worker)return this.worker=document.createElement("iframe"),this.worker.style.display="none",this.worker.src=this.hpURL("/platform/worker"),document.body.appendChild(this.worker)},e.prototype.sendMessage=function(e){var t;return null==e&&(e={}),(t=document.createEvent("CustomEvent")).initCustomEvent(this.hpEvent(e.type),!0,!0,e.data),(e.element||this.xdm).dispatchEvent(t)},e.prototype.hpURL=function(e){return this.origin+e},e.prototype.hpNamespace=function(e){return"harvest-"+e},e.prototype.hpEvent=function(e){return this.hpNamespace("event")+":"+e},e.prototype.param=function(e){var t,n;return function(){var r;for(t in r=[],e)null!=(n=e[t])&&r.push(t+"="+encodeURIComponent(n));return r}().join("&")},e.prototype.get=function(e,t){var n;return(n=new XMLHttpRequest).onload=function(){return t(n.status,function(){try{return JSON.parse(n.responseText)}catch(e){}}(),n)},n.open("get",e),n.withCredentials=!0,n.setRequestHeader("X-Harvest-Platform-Version",this.version),n.send()},e.prototype.debounce=function(e){var t,n;return t=null,n=this,function(){var r;return r=1<=arguments.length?o.call(arguments,0):[],clearTimeout(t),t=setTimeout(function(){return e.call.apply(e,[n].concat(o.call(r)))},100)}},e}()},{"../ext/set_fuzzy_timeout":2,"./light_box":4}],4:[function(e,t){t.exports=function(){function e(){var e;this.el=document.createElement("div"),this.el.className="harvest-overlay",this.iframe=document.createElement("iframe"),this.iframe.id="harvest-iframe",this.el.appendChild(this.iframe),this.el.addEventListener("click",(e=this,function(){return e.close()})),document.addEventListener("keyup",function(e){return function(t){if(27===t.which)return e.close()}}(this))}return e.prototype.open=function(e){return this.iframe.src=e,document.body.appendChild(this.el)},e.prototype.adjustHeight=function(e){return this.iframe.style.height=e+"px"},e.prototype.close=function(){var e;return null!=(e=this.el.parentNode)?e.removeChild(this.el):void 0},e}()},{}]},{},[1]);